# 0001 编辑器与协作技术选型

## 背景
需要支持块级富文本、@ 提及、(( 块引用）与多人实时协作（含离线后合并）。

## 决策
- 富文本：基于 ProseMirror（TipTap）实现编辑器与插件体系。
- 协作：采用 Yjs（CRDT）+ y-websocket；前端文档按元素维度分片。

## 备选方案
- Slate（轻量但生态相对弱）；OT（需自研合并与服务，离线复杂）。

## 理由
- ProseMirror 生态成熟，复杂块结构与可拓展性优；Yjs 具备离线与冲突自动合并能力。

## 影响
- 后端以 content_json（ProseMirror JSON）为主存；导出时派生 Markdown/HTML。
- 需要服务端二次权限校验，避免协作通道绕过权限。

## 后续事项
- 定义块ID生成与稳定策略；为块引用提供 block_ref 投影表。
